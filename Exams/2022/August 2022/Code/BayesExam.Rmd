---
title: "BayesExam"
author: "Christophoros Spyretos"
date: '2022-10-17'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Problem 1 

## Task d

```{r}
LogPost <- function(theta,n,sumx){
  res <- (4+3*n-1)*log(theta) - theta*(2 - (1/sumx))
  return(res)
}

thetaGrid <- seq(2,20,0.01)
n <- 4
obs <- c(0.7,1.1,0.9,1.5)
sumx <- sum(obs)

LogPost_propto <- exp(LogPost(thetaGrid,n,sumx))
LogPost_Dens <- LogPost_propto/(0.01*sum(LogPost_propto))

plot(thetaGrid,LogPost_Dens, type = "l", col = "navy",
     main = "Posterior Distribution of theta",
     xlab = "theta", ylab = "")
```

## Task e

```{r}
OptimRes <- optim(5, LogPost, gr = NULL, n, sumx,
                  method = c("L-BFGS-B"),lower = 0.1,
                  control = list(fnscale = -1),
                  hessian = TRUE)

approx <- dnorm(thetaGrid, mean = OptimRes$par, 
                sd = sqrt(diag(-solve(OptimRes$hessian))))

plot(thetaGrid,LogPost_Dens, type = "l", col = "navy",
     main = "Posterior Distribution of theta",
     xlab = "theta", ylab = "")
lines(thetaGrid,approx, type = "l", col = "red3")
legend("topright", legend = c("Exact","Approximated"), 
       col = c("navy", "red3"), lty = 1:2)
```

The posterior approximation accurate, the exact posterior is slighlty skewed to the right.

# Problem 2

```{r}
source("ExamData.R")
```

## Task a

```{r}
mu_0 <- as.vector(rep(0,3))
Sigma_0 <- 100*diag(3)
nIter <- 20000

PostDraws <- BayesLogitReg(y, X, mu_0, Sigma_0, nIter)

Betas <- PostDraws$betaSample

intervalB1 <- quantile(Betas[,2], probs = c(0.025,0.975))

intervalB1 <- data.frame(lower_bound = intervalB1[1], 
                         upper_bound = intervalB1[2])
colnames(intervalB1) <- c("Lower bound", "Upper bound")
rownames(intervalB1) <- c("95% Equal Tail Credible Interval")
knitr::kable(intervalB1)
```

There is 95% posterioir probability that $\beta_1$ is in the interval (0.014,0.181).

## Task b

```{r}
prob2b <- mean(Betas[,2]>0 & Betas[,3]>0)
```

The joint posterior probability that both $\beta_1 > 0$ and $\beta_2 > 0$ is appriximately 0.91.

## Task c

```{r}
numerator <- exp(Betas[,1] + Betas[,2]*5 + Betas[,3]*1)
pi <- numerator/(1+numerator)

odds <- (1-pi)/pi

plot(density(odds), type = "l", col = "navy",
     main = "Posterior Distribution of (1-p)/p",
     xlab = "(1-p)/p", ylab = "")
```

```{r}
min(X[,2])
```

The plot seems reasonable with very large values of this odds as this bridge is built very recently. The reliability of these results should be questioned because a five-year-old bridge is much newer compared to the youngest bridge of 19 years in the data.

```{r}
x1Grid <- seq(min(X[,2]), max(X[,2]),0.1)
intervals <- matrix(0,length(x1Grid),2)

for (i in 1:length(x1Grid)){
  numerator <- exp(Betas[,1] + Betas[,2]*x1Grid[i])
  pi <- numerator/(1+numerator)
  intervals[i,] <- quantile(pi,probs = c(0.025,0.975))
}

plot(x1Grid,intervals[,1], type = "l", col = "navy",
     main = "95 % equal tail posterior probability intervals for pi on a grid of values of x1",
     xlab = "x1", ylab = "", ylim = c(0,1))
lines(x1Grid,intervals[,2], type = "l", col = "navy")
```

## Task e

```{r}
numerator <- exp(Betas[,1] + Betas[,2]*40 + Betas[,3]*1)
pi <- numerator/(1+numerator)

plot(density(pi), type = "l", col = "navy",
     main = "Posterior Distribution of p",
     xlab = "p", ylab = "")

prob2e <- mean(pi>0.5)
```

The posterior probability that $p_i > 0.5$ for this bridge is 0.1577.

# Probem 3

## Task c

```{r}
theta <- 19/30
buy <- theta*60 + (1-theta)*(-20)
nobuy <- theta*180 + (1-theta)*(-240)
```

Since the expected utility when buying the option is higher (30.7 compared to 26), the bank should buy the option.